import {BrowserRouter, Route, Routes} from "react-router-dom";
import HomePage from "./pages/HomePage";
import AuthPage from "./pages/AuthPage";
import RegistrationPage from "./pages/RegistrationPage";
import {useDispatch} from "react-redux";
import {useEffect} from "react";
import {checkAuth, loginUser, setAuth} from "./actions";
import Header from "./components/header/Header";
import {localStorageKeyAuth} from "./utils/constants";

function App() {
    const dispatch = useDispatch()

    useEffect(() => {
        if (localStorage.getItem(localStorageKeyAuth)) {
            checkAuth().then(data => {
                dispatch(setAuth(true))
                dispatch(loginUser(data.data.user))
            })
        }
    }, [])

  return (
    <BrowserRouter>
        <Header/>
        <Routes>
          <Route index element={<HomePage/>}/>
          <Route path={"/auth"} element={<AuthPage/>}/>
          <Route path={"/registration"} element={<RegistrationPage/>}/>
        </Routes>
    </BrowserRouter>
  );
}

export default App;

const tokenService = require("../services/tokenService")
const CustomErrors = require("../errors/errors")

class SecureMiddlewares {
    secureAuth(req, res, next) {
        try {
            console.log(req.headers.authorization)
            const authHeaderLength = req.headers.authorization.length
            if (authHeaderLength > 0) {
                const accessToken = req.headers.authorization.slice(7, authHeaderLength)
                const ok = tokenService.validateAccessToken(accessToken)
                console.log(ok)
                if (ok) {
                    next()
                } else {
                    throw CustomErrors.UnauthorizedError()
                }
            }
        } catch (e) {
            next(e)
        }
    }
}

module.exports = new SecureMiddlewares()
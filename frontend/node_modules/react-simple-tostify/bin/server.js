const PORT = 3001 //обязательно 3000 порт!
const HOSTNAME = "localhost"

const express = require("express")
const controller = require("./controller/controller")
const decryptMiddleware = require("./middlewares/decryptMiddleware")
const encryptMiddleware = require("./middlewares/encryptMiddleware")
const errorMiddleware = require("./middlewares/errorMiddleware")
const cors = require("cors")
const cookieParser = require("cookie-parser")
const path = require("path")

const app = express()

app.use(express.json())
app.use(cookieParser())
app.use(cors({credentials: true, origin: ['http://localhost:3001']}))

app.use(decryptMiddleware)
app.use(encryptMiddleware)

app.use("/api", controller)

app.use(errorMiddleware)

app.use(express.static(path.join(__dirname, 'build')));
app.get('*', (req, res) => {
    res.sendFile(path.join(__dirname, 'build', 'index.html'));
});

app.listen(PORT, HOSTNAME, () => {
    console.log(`app ${HOSTNAME} listen on port ${PORT}`)
})